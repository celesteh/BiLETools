<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="1038.36">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica}
p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica; min-height: 17.0px}
p.p6 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 12.0px Helvetica}
p.p7 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 14.0px Helvetica}
p.p8 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 14.0px Helvetica; min-height: 17.0px}
p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco}
p.p10 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco}
p.p11 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco; color: #1100d0}
p.p12 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco; color: #e10000}
p.p13 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p14 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #737373}
p.p15 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #e10000}
p.p16 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco; color: #008900}
span.s1 {font: 18.0px Helvetica}
span.s2 {font: 9.0px Monaco}
span.s3 {font: 9.0px Monaco; color: #1100d0}
span.s4 {font: 14.0px Helvetica}
span.s5 {font: 12.0px Helvetica}
span.s6 {color: #000000}
span.s7 {color: #1100d0}
span.s8 {color: #737373}
span.s9 {color: #e10000}
span.s10 {color: #008900}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><br></p>
<p class="p2"><span class="s1"><b>SharedResource<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b></span><b>a controlled, sharable bit of data</b></p>
<p class="p1"><br></p>
<p class="p1"><br></p>
<p class="p2"><b>Requires:</b></p>
<p class="p2">•<span class="Apple-converted-space">  </span>ProcessTools, a quark</p>
<p class="p2">•<span class="Apple-converted-space">  </span>OscGroups, external program, download from http://www.audiomulch.com/~rossb/code/oscgroups/</p>
<p class="p2">•<span class="Apple-converted-space">  </span>OscGroupClient, Les's altered version</p>
<p class="p2">•<span class="Apple-converted-space">  </span>NetAPI</p>
<p class="p3"><br></p>
<p class="p2">This class holds a piece of data.<span class="Apple-converted-space">  </span>Interested parties can register listeners to be notified when the data changes.</p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<p class="p4"><b>Creation / Class Methods</b></p>
<p class="p5"><br></p>
<p class="p6"><b><span class="Apple-tab-span">	</span>*new (value, threadSafe, changeFunc)</b></p>
<p class="p6"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>value </b>- The initial value to hold in the SharedResource</p>
<p class="p6"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>threadSafe </b>-<span class="Apple-converted-space">  </span>a boolean. If this is set to true, a semaphore controls access to change the value. Default value is false</p>
<p class="p6"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>changeFunc </b>-<span class="Apple-converted-space">  </span>a function that returns a boolean which should determine whether or not to update <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>listeners.<span class="Apple-converted-space">  </span>This defaults to <span class="s2">{</span><span class="s3">|old, new|</span><span class="s2"> old != new}</span></p>
<p class="p3"><br></p>
<p class="p7"><b>Methods</b></p>
<p class="p8"><br></p>
<p class="p2"><b><span class="Apple-tab-span">	</span>value<span class="Apple-converted-space">  </span></b>- the value currently held in the SharedResource</p>
<p class="p3"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="s4"><b><span class="Apple-tab-span">	</span></b></span><b>spec_ (s, v, changer)</b></p>
<p class="p6"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>s </b>-<span class="Apple-converted-space">  </span>s.value should return a ControlSpec</p>
<p class="p6"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>v </b>- a value to set the SharedResourceValue to<span class="Apple-converted-space"> </span></p>
<p class="p6"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>changer </b>- who has called this method?</p>
<p class="p3"><br></p>
<p class="p2"><span class="Apple-tab-span">	</span><b>sp (default, lo, high, step, warp, changer)</b></p>
<p class="p2"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>default, lo, high, step, warp </b>-<span class="Apple-converted-space">  </span>See the help file for ControlSpec</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>changer </b>- who has called this method?</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p2"><span class="Apple-tab-span">	</span><b>value_(newValue, theChanger ... moreArgs)</b></p>
<p class="p2"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>newValue</b><span class="Apple-tab-span">	</span>- this can be any sort of object.<span class="Apple-converted-space">  </span>it will be sent a value message with the existing</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>value as an argument, so if you want to do a mathematical expression, you could use<span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>something like</p>
<p class="p9"><span class="s5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>{|old| old + 1}</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>theChanger </b>- the caller of this method, who will not be notified of the change</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>moreArgs </b>- Additional arguments to use when calling action functions</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p2"><span class="Apple-tab-span">	</span><b>changeFunc_(function)</b></p>
<p class="p2"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>function </b>-<span class="Apple-converted-space">  </span>a function that returns a boolean which should determine whether or not to update</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>listeners.</p>
<p class="p3"><br></p>
<p class="p2"><span class="Apple-tab-span">	</span><b>action_(adder, action)</b></p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>If there are are two argument to action_, they are treated as:</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>adder </b>- The entity that is adding an action</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>action </b>- When the value in the SharedResource changes, this will evaluate action.value(this), but</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>ONLY if the adder is not the one causing the value to change</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p2"><span class="Apple-tab-span">	</span><b>action_(action)</b></p>
<p class="p2"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>If there is only one argument to action_, it is treated as:</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>action </b>- When the value in the SharedResource changes, this will evaluate action.value(this)</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p2"><span class="Apple-tab-span">	</span><b>RemoveAction(toBeRemoved)</b></p>
<p class="p2"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Get rid of the action that is to be removed</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p2"><span class="Apple-tab-span">	</span><b>mountAPI(api, symbol, description, broadcast)</b></p>
<p class="p2"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Share this resource across a network. This returns and instance of SharedRemoteListeners</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>api </b>- an instance of NetAPI</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>symbol </b>- The key to use to identify this data on OSC</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>description </b>- a String that documents what sort of data we're sharing with this object</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>broadcast</b>- a Boolean. If true, the entire network is notified of updates. If false, only registered<span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>listeners are</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p7"><b>Examples</b></p>
<p class="p8"><br></p>
<p class="p10">(</p>
<p class="p11"><span class="s6"><span class="Apple-tab-span">	</span>a = </span>SharedResource<span class="s6">(5);</span></p>
<p class="p10"><span class="Apple-tab-span">	</span>a.action_({<span class="s7">|val|</span> val.value.postln; });</p>
<p class="p10"><span class="Apple-tab-span">	</span>a.value_(<span class="s8">"Wow!"</span>);</p>
<p class="p10"><span class="Apple-tab-span">	</span>a.value_(2.2);</p>
<p class="p10">)</p>
<p class="p8"><br></p>
<p class="p8"><br></p>
<p class="p12">// changeFunc_ example</p>
<p class="p10">(</p>
<p class="p11"><span class="s6"><span class="Apple-tab-span">	</span>a = </span>SharedResource<span class="s6">(5);</span></p>
<p class="p10"><span class="Apple-tab-span">	</span>a.action_({<span class="s7">|val|</span> val.value.postln; });</p>
<p class="p12"><span class="s6"><span class="Apple-tab-span">	</span>a.value_({</span><span class="s7">|old|</span><span class="s6"> old + 1}); </span>// run this last line a few times</p>
<p class="p13"><span class="Apple-tab-span">	</span></p>
<p class="p10"><span class="Apple-tab-span">	</span>a.changeFunc_({<span class="s7">|old, new|</span> (old - new).abs &gt; 1}) <span class="s9">// only alert people if the<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// change is greater than 1</p>
<p class="p13"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="s6"><span class="Apple-tab-span">	</span>a.value_({</span><span class="s7">|old|</span><span class="s6"> old + 1}); </span>// run this last line a few times</p>
<p class="p13"><span class="Apple-tab-span">	</span></p>
<p class="p10">)</p>
<p class="p13"><br></p>
<p class="p13"><br></p>
<p class="p12">// preventing an infinite loop example</p>
<p class="p10">(</p>
<p class="p10"><span class="Apple-tab-span">	</span>w=<span class="s7">Window</span>.new.front;</p>
<p class="p10"><span class="Apple-tab-span">	</span>w.view.decorator=<span class="s7">FlowLayout</span>(w.view.bounds);</p>
<p class="p13"><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="s6"><span class="Apple-tab-span">	</span>a = </span>SharedResource<span class="s6">(440);</span></p>
<p class="p9"><span class="Apple-tab-span">	</span>g = <span class="s7">EZSlider</span>(<span class="Apple-tab-span">	</span>w,<span class="Apple-converted-space">  <span class="Apple-tab-span">	</span></span><span class="s9">// parent</span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>390@20,<span class="Apple-tab-span">	</span><span class="s9">// bounds</span></p>
<p class="p14"><span class="s6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>" test "<span class="s6">,<span class="Apple-tab-span">	</span></span><span class="s9">// label</span></p>
<p class="p15"><span class="s6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s10">\freq</span><span class="s6"> <span class="Apple-tab-span">	</span></span>// controlSpec</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>);</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p9"><span class="Apple-tab-span">	</span>h = <span class="s7">EZSlider</span>(<span class="Apple-tab-span">	</span>w,<span class="Apple-converted-space">  <span class="Apple-tab-span">	</span></span><span class="s9">// parent</span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>390@20,<span class="Apple-tab-span">	</span><span class="s9">// bounds</span></p>
<p class="p14"><span class="s6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>" test "<span class="s6">,<span class="Apple-tab-span">	</span></span><span class="s9">// label</span></p>
<p class="p15"><span class="s6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s10">\freq</span><span class="s6"> <span class="Apple-tab-span">	</span></span>// controlSpec</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>);</p>
<p class="p1"><span class="Apple-tab-span">	</span></p>
<p class="p15"><span class="s6"><span class="Apple-tab-span">	</span>g.action_({</span><span class="s7">|ez|</span><span class="s6"> a.value_(ez.value, g) }); </span>// when g updates the value, it identifies itself</p>
<p class="p15"><span class="s6"><span class="Apple-tab-span">	</span>h.action_({</span><span class="s7">|ez|</span><span class="s6"> a.value_(ez.value, h) }); </span>// when h updates the value, it identifies itself</p>
<p class="p1"><br></p>
<p class="p15"><span class="s6"><span class="Apple-tab-span">	</span>a.action_(g, {</span><span class="s7">|val|</span><span class="s6"> g.value_(val.value)}); </span>// tell the shared reource how to inform g</p>
<p class="p15"><span class="s6"><span class="Apple-tab-span">	</span>a.action_(h, {</span><span class="s7">|val|</span><span class="s6"> h.value_(val.value)}); </span>// tell the shared reource how to inform h</p>
<p class="p1"><span class="Apple-tab-span">	</span></p>
<p class="p15"><span class="s6"><span class="Apple-tab-span">	</span></span>// this does not cause an infinite loop because it does not notify the slider that took</p>
<p class="p15"><span class="s6"><span class="Apple-tab-span">	</span></span>// credit for changing it.<span class="Apple-converted-space"> </span></p>
<p class="p13"><br></p>
<p class="p10">)</p>
<p class="p13"><br></p>
<p class="p13"><br></p>
<p class="p12">// network example</p>
<p class="p13"><br></p>
<p class="p12">// run this part one computer A</p>
<p class="p13"><br></p>
<p class="p10"><span class="Apple-tab-span">	</span>n = <span class="s7">NetAPI</span>.broadcast(<span class="s8">"A"</span>);</p>
<p class="p11"><span class="s6"><span class="Apple-tab-span">	</span>a = </span>SharedResource<span class="s6">(3);</span></p>
<p class="p10"><span class="Apple-tab-span">	</span>a = a.action_({<span class="s7">|val|</span> val.value.postln});</p>
<p class="p12"><span class="s6"><span class="Apple-tab-span">	</span>r = a.mountAPI(n, </span><span class="s10">'demo'</span><span class="s6">, </span><span class="s8">"a small integer"</span><span class="s6">); </span>// returns an instance of SharedRemoteListeners</p>
<p class="p13"><span class="Apple-tab-span">	</span></p>
<p class="p12">// now run this on computer B</p>
<p class="p13"><br></p>
<p class="p10"><span class="Apple-tab-span">	</span>m = <span class="s7">NetAPI</span>.broadcast(<span class="s8">"B"</span>);</p>
<p class="p10"><span class="Apple-tab-span">	</span>b = m.subscribe(<span class="s10">'A/demo'</span>);</p>
<p class="p10"><span class="Apple-tab-span">	</span>b.action_({<span class="s7">|val|</span> val.value.postln});</p>
<p class="p13"><span class="Apple-tab-span">	</span></p>
<p class="p12">// now go back to computer A</p>
<p class="p13"><br></p>
<p class="p10"><span class="Apple-tab-span">	</span>a.value_(6);</p>
<p class="p10"><span class="Apple-tab-span">	</span>a.value_({<span class="s7">|old|</span> old + 1.1});</p>
<p class="p13"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="s6"><span class="Apple-tab-span">	</span></span>// change it to only send every other update across the network:</p>
<p class="p12"><span class="s6"><span class="Apple-tab-span">	</span>r.n = 2;<span class="Apple-converted-space">  </span></span>// every n times, send the message</p>
<p class="p10"><span class="Apple-tab-span">	</span>a.value_({<span class="s7">|old|</span> old + 1.1});</p>
<p class="p13"><span class="Apple-tab-span">	</span></p>
<p class="p13"><span class="Apple-tab-span">	</span></p>
<p class="p12">// now go back to computer B</p>
<p class="p13"><br></p>
<p class="p10"><span class="Apple-tab-span">	</span>m.add(<span class="s10">'say'</span>, { <span class="s7">|something|</span> something.asString.speak});</p>
<p class="p16"><span class="s6"><span class="Apple-tab-span">	</span>m.map(</span>'A/demo'<span class="s6">, </span>'say'<span class="s6">);<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s6"><span class="Apple-tab-span">	</span></span>// that maps a SharedResource with an API key</p>
<p class="p12"><span class="s6"><span class="Apple-tab-span">	</span></span>// the remote resource 'demo' will call the local API method 'say'</p>
<p class="p13"><span class="Apple-tab-span">	</span></p>
<p class="p12">// and back to computer A</p>
<p class="p13"><br></p>
<p class="p10"><span class="Apple-tab-span">	</span>r.n = 1;</p>
<p class="p10"><span class="Apple-tab-span">	</span>a.value_(0);</p>
<p class="p13"><span class="Apple-tab-span">	</span></p>
</body>
</html>
